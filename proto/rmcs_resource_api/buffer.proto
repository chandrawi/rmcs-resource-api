syntax = "proto3";
package buffer;

import "rmcs_resource_api/common.proto";

service BufferService {
    rpc ReadBuffer(BufferId) returns (BufferReadResponse);

    rpc ReadBufferByTime(BufferTime) returns (BufferReadResponse);

    rpc ReadBufferFirst(BufferSelector) returns (BufferReadResponse);

    rpc ReadBufferLast(BufferSelector) returns (BufferReadResponse);

    rpc ListBufferFirst(BuffersSelector) returns (BufferListResponse);

    rpc ListBufferLast(BuffersSelector) returns (BufferListResponse);

    rpc CreateBuffer(BufferSchema) returns (BufferCreateResponse);

    rpc UpdateBuffer(BufferUpdate) returns (BufferChangeResponse);

    rpc DeleteBuffer(BufferId) returns (BufferChangeResponse);
}

enum BufferStatus {
    DEFAULT = 0;
    ERROR = 1;
    DELETE = 2;
    HOLD = 3;
    SEND_UPLINK = 4;
    SEND_DOWNLINK = 5;
    TRANSFER_LOCAL = 6;
    TRANSFER_GATEWAY = 7;
    TRANSFER_SERVER = 8;
    BACKUP = 9;
    RESTORE = 10;
    ANALYSIS_1 = 11;
    ANALYSIS_2 = 12;
    ANALYSIS_3 = 13;
    ANALYSIS_4 = 14;
    ANALYSIS_5 = 15;
    ANALYSIS_6 = 16;
    ANALYSIS_7 = 17;
    ANALYSIS_8 = 18;
    ANALYSIS_9 = 19;
    ANALYSIS_10 = 20;
}

message BufferSchema {
    int32 id = 1;
    bytes device_id = 2;
    bytes model_id = 3;
    int64 timestamp = 4;
    bytes data_bytes = 5;
    repeated common.DataType data_type = 6;
    BufferStatus status = 7;
}

message BufferId {
    int32 id = 1;
}

message BufferTime {
    bytes device_id = 1;
    bytes model_id = 2;
    int64 timestamp = 3;
    optional BufferStatus status = 4;
}

message BufferSelector {
    optional bytes device_id = 1;
    optional bytes model_id = 2;
    optional BufferStatus status = 3;
}

message BuffersSelector {
    optional bytes device_id = 1;
    optional bytes model_id = 2;
    optional BufferStatus status = 3;
    uint32 number = 4;
}

message BufferUpdate {
    int32 id = 1;
    optional bytes data_bytes = 6;
    repeated common.DataType data_type = 7;
    optional BufferStatus status = 8;
}

message BufferReadResponse {
    BufferSchema result = 1;
}

message BufferListResponse {
    repeated BufferSchema results = 1;
}

message BufferCreateResponse {
    int32 id = 1;
}

message BufferChangeResponse {
}
